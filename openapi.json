{"openapi":"3.1.0","info":{"title":"mmopdca API","description":"Command-DSL-driven forecasting micro-service API only","contact":{"name":"gtocue","email":"gtocue510@gmail.com"},"version":"0.4.0"},"paths":{"/plan/":{"get":{"tags":["plan"],"summary":"List Plans","operationId":"list_plans_plan__get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"items":{"$ref":"#/components/schemas/PlanResponse"},"type":"array","title":"Response List Plans Plan  Get"}}}}},"security":[{"APIKeyHeader":[]}]},"post":{"tags":["plan"],"summary":"Create Plan","description":"新しい Plan を登録する。\n\n* `id` を省略すると `plan_<8桁>` を自動採番。\n* 同じ `id` が既にあれば **409 Conflict**。","operationId":"create_plan_plan__post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PlanCreateRequest"}}},"required":true},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PlanResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"APIKeyHeader":[]}]}},"/plan/{plan_id}":{"get":{"tags":["plan"],"summary":"Get Plan by ID","operationId":"get_plan_plan__plan_id__get","security":[{"APIKeyHeader":[]}],"parameters":[{"name":"plan_id","in":"path","required":true,"schema":{"type":"string","title":"Plan Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PlanResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"delete":{"tags":["plan"],"summary":"Delete Plan","operationId":"delete_plan_plan__plan_id__delete","security":[{"APIKeyHeader":[]}],"parameters":[{"name":"plan_id","in":"path","required":true,"schema":{"type":"string","title":"Plan Id"}}],"responses":{"204":{"description":"Successful Response"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/plan-dsl/":{"get":{"tags":["plan-dsl"],"summary":"List DSL Plans","operationId":"list_plans_dsl_plan_dsl__get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"items":{"$ref":"#/components/schemas/PlanResponse"},"type":"array","title":"Response List Plans Dsl Plan Dsl  Get"}}}}},"security":[{"APIKeyHeader":[]}]},"post":{"tags":["plan-dsl"],"summary":"Create Plan from DSL (YAML / JSON)","description":"DSL ファイル *または* 生テキスト body を受け取り Plan を登録。\n\n**PowerShell 例**\n\n```powershell\n$yaml = Get-Content .\\samples\\plan_mvp.yaml -Raw\nInvoke-RestMethod `\n  -Uri 'http://localhost:8001/plan-dsl/' `\n  -Method Post `\n  -Body $yaml `\n  -ContentType 'application/x-yaml'\n```","operationId":"create_plan_dsl_plan_dsl__post","requestBody":{"content":{"multipart/form-data":{"schema":{"$ref":"#/components/schemas/Body_create_plan_dsl_plan_dsl__post"}}}},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PlanResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"APIKeyHeader":[]}]}},"/plan-dsl/{plan_id}":{"get":{"tags":["plan-dsl"],"summary":"Get DSL Plan","operationId":"get_plan_dsl_plan_dsl__plan_id__get","security":[{"APIKeyHeader":[]}],"parameters":[{"name":"plan_id","in":"path","required":true,"schema":{"type":"string","title":"Plan Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PlanResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/do/{plan_id}":{"post":{"tags":["do"],"summary":"Enqueue Do job (Celery)","description":"Plan に紐づく Do フェーズのジョブを Celery に enqueue（または同期実行）する。","operationId":"enqueue_do_do__plan_id__post","security":[{"APIKeyHeader":[]}],"parameters":[{"name":"plan_id","in":"path","required":true,"schema":{"type":"string","title":"Plan Id"}}],"requestBody":{"content":{"application/json":{"schema":{"anyOf":[{"$ref":"#/components/schemas/DoCreateRequest"},{"type":"null"}],"title":"Body"}}}},"responses":{"202":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"object","additionalProperties":{"type":"string"},"title":"Response Enqueue Do Do  Plan Id  Post"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/do/{do_id}":{"get":{"tags":["do"],"summary":"Get Do record","description":"do_id で指定した Do レコードを返す。","operationId":"get_do_do__do_id__get","security":[{"APIKeyHeader":[]}],"parameters":[{"name":"do_id","in":"path","required":true,"schema":{"type":"string","title":"Do Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DoResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/do/status/{task_id}":{"get":{"tags":["do"],"summary":"Raw Celery task state","description":"Celery の AsyncResult を使って、タスクの生の状態を返す。","operationId":"get_do_status_do_status__task_id__get","security":[{"APIKeyHeader":[]}],"parameters":[{"name":"task_id","in":"path","required":true,"schema":{"type":"string","title":"Task Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"object","title":"Response Get Do Status Do Status  Task Id  Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/do/":{"get":{"tags":["do"],"summary":"List Do records","description":"保存済みの全 Do レコード一覧を返す。","operationId":"list_do_do__get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"items":{"$ref":"#/components/schemas/DoResponse"},"type":"array","title":"Response List Do Do  Get"}}}}},"security":[{"APIKeyHeader":[]}]}},"/check/{do_id}":{"post":{"tags":["check"],"summary":"Enqueue Check job (Celery)","description":"Check フェーズのタスクを Celery に登録 & 初期レコードを作成","operationId":"enqueue_check_check__do_id__post","security":[{"APIKeyHeader":[]}],"parameters":[{"name":"do_id","in":"path","required":true,"schema":{"type":"string","title":"Do Id"}}],"responses":{"202":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/check/{check_id}":{"get":{"tags":["check"],"summary":"Get Check record","description":"永続化されたチェックレコードを返却","operationId":"get_check_check__check_id__get","security":[{"APIKeyHeader":[]}],"parameters":[{"name":"check_id","in":"path","required":true,"schema":{"type":"string","title":"Check Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/CheckResult"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/check/status/{task_id}":{"get":{"tags":["check"],"summary":"Raw Celery task state","description":"Celery タスクの生ステータスおよびエラーを取得","operationId":"get_check_status_check_status__task_id__get","security":[{"APIKeyHeader":[]}],"parameters":[{"name":"task_id","in":"path","required":true,"schema":{"type":"string","title":"Task Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"object","title":"Response Get Check Status Check Status  Task Id  Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/check/":{"get":{"tags":["check"],"summary":"List Check records","description":"保存済みの Check レコードをすべて返却","operationId":"list_check_check__get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"items":{"$ref":"#/components/schemas/CheckResult"},"type":"array","title":"Response List Check Check  Get"}}}}},"security":[{"APIKeyHeader":[]}]}},"/act/{check_id}":{"post":{"tags":["act"],"summary":"Run Act (decide next action)","operationId":"create_act_act__check_id__post","security":[{"APIKeyHeader":[]}],"parameters":[{"name":"check_id","in":"path","required":true,"schema":{"type":"string","description":"Check ID to act on","title":"Check Id"},"description":"Check ID to act on"}],"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ActDecision"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/act/{act_id}":{"get":{"tags":["act"],"summary":"Get ActDecision","operationId":"get_act_act__act_id__get","security":[{"APIKeyHeader":[]}],"parameters":[{"name":"act_id","in":"path","required":true,"schema":{"type":"string","title":"Act Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ActDecision"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/act/":{"get":{"tags":["act"],"summary":"List ActDecision","operationId":"list_act_act__get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"items":{"$ref":"#/components/schemas/ActDecision"},"type":"array","title":"Response List Act Act  Get"}}}}},"security":[{"APIKeyHeader":[]}]}},"/metrics/{name}":{"get":{"tags":["metrics"],"summary":"Get instant metric value","operationId":"get_metric_value_metrics__name__get","security":[{"APIKeyHeader":[]}],"parameters":[{"name":"name","in":"path","required":true,"schema":{"type":"string","title":"Name"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/MetricValue"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/metrics/":{"get":{"tags":["metrics"],"summary":"List metric catalog","operationId":"list_metrics_metrics__get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"items":{"$ref":"#/components/schemas/MetricMeta"},"type":"array","title":"Response List Metrics Metrics  Get"}}}}},"security":[{"APIKeyHeader":[]}]}}},"components":{"schemas":{"ActAction":{"type":"string","enum":["noop","retrain","alert"],"title":"ActAction"},"ActDecision":{"properties":{"id":{"type":"string","title":"Id","description":"act-xxxx 一意 ID"},"check_id":{"type":"string","title":"Check Id","description":"紐づく Check ID"},"decided_at":{"type":"string","format":"date-time","title":"Decided At","description":"UTC ISO8601"},"action":{"$ref":"#/components/schemas/ActAction"},"reason":{"type":"string","title":"Reason","description":"意思決定根拠 (人間可読)"}},"type":"object","required":["id","check_id","decided_at","action","reason"],"title":"ActDecision"},"Body_create_plan_dsl_plan_dsl__post":{"properties":{"file":{"anyOf":[{"type":"string","format":"binary"},{"type":"null"}],"title":"File"}},"type":"object","title":"Body_create_plan_dsl_plan_dsl__post"},"CheckReport":{"properties":{"r2":{"type":"number","maximum":1.0,"minimum":-1.0,"title":"R2","description":"決定係数"},"threshold":{"type":"number","maximum":1.0,"minimum":-1.0,"title":"Threshold","description":"合格ライン"},"passed":{"type":"boolean","title":"Passed","description":"閾値をクリアしたら True"}},"additionalProperties":true,"type":"object","required":["r2","threshold","passed"],"title":"CheckReport","description":"可変キーを許容する緩いメトリクスモデル。\nデフォルト項目として r2 / threshold / passed を持ち、\n追加指標 (rmse, mape など) は extra=\"allow\" で拡張可能。"},"CheckResult":{"properties":{"id":{"type":"string","title":"Id","description":"check-xxxx 形式の一意 ID"},"do_id":{"type":"string","title":"Do Id","description":"評価対象の Do ID"},"created_at":{"type":"string","format":"date-time","title":"Created At","description":"UTC ISO8601"},"report":{"anyOf":[{"additionalProperties":{"anyOf":[{"type":"integer"},{"type":"number"},{"type":"string"},{"type":"boolean"}]},"type":"object"},{"$ref":"#/components/schemas/CheckReport"},{"type":"null"}],"title":"Report","description":"メトリクス JSON (タスク完了前は None)"}},"type":"object","required":["id","do_id","created_at"],"title":"CheckResult","description":"/check エンドポイントのレスポンス & ストレージフォーマット\nreport はタスク未完了時に None を返すケースを考慮"},"DoCreateRequest":{"properties":{"symbol":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Symbol","description":"ティッカー（例: AAPL, ETH-USD）","examples":["AAPL"]},"start":{"anyOf":[{"type":"string","format":"date"},{"type":"null"}],"title":"Start","description":"学習開始日 (YYYY-MM-DD)","examples":["2025-01-01"]},"end":{"anyOf":[{"type":"string","format":"date"},{"type":"null"}],"title":"End","description":"学習終了日 (YYYY-MM-DD)","examples":["2025-12-31"]},"indicators":{"anyOf":[{"items":{"$ref":"#/components/schemas/IndicatorParam"},"type":"array","minItems":0},{"type":"null"}],"title":"Indicators","description":"追加テクニカル指標リスト（空 list で『追加なし』）"},"run_no":{"anyOf":[{"type":"integer","minimum":1.0},{"type":"null"}],"title":"Run No","description":"連番 (1,2,3 …)。未指定なら `seq` をフォールバック","examples":[1,2]},"seq":{"anyOf":[{"type":"integer","minimum":1.0},{"type":"null"}],"title":"Seq","description":"※ deprecated – `run_no` に自動コピーされる","examples":[1,2]},"run_tag":{"anyOf":[{"type":"string","maxLength":32},{"type":"null"}],"title":"Run Tag","description":"自由ラベル（A/B テスト名など）","examples":["baseline","weekly-run"]}},"type":"object","title":"DoCreateRequest","description":"Do フェーズ実行リクエスト。\n\nすべて **任意**。未指定項目は対応する Plan の値を継承する。"},"DoResponse":{"properties":{"do_id":{"type":"string","title":"Do Id","description":"Do 実行 ID (`do-xxxx` 形式)"},"plan_id":{"type":"string","title":"Plan Id","description":"紐づく Plan ID"},"seq":{"type":"integer","minimum":1.0,"title":"Seq","description":"DoCreateRequest.run_no のエコーバック（互換: 'seq'）"},"run_tag":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Run Tag","description":"DoCreateRequest.run_tag のエコーバック"},"status":{"$ref":"#/components/schemas/DoStatus","description":"ジョブ状態"},"result":{"anyOf":[{"type":"object"},{"type":"null"}],"title":"Result","description":"ジョブ完了時の任意ペイロード\n  • DONE   : メトリクスや artefact URI など\n  • FAILED : {'error': '...'} など"},"artifact_uri":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Artifact Uri","description":"Parquet 予測ファイルの保存 URI"},"dashboard_url":{"anyOf":[{"type":"string","maxLength":2083,"minLength":1,"format":"uri"},{"type":"null"}],"title":"Dashboard Url","description":"Superset 等に自動生成された可視化 URL（任意）"}},"type":"object","required":["do_id","plan_id","seq","status"],"title":"DoResponse","description":"Do ジョブの状態および結果レスポンス。\n\n`status` 遷移: **PENDING → RUNNING → (DONE | FAILED)**"},"DoStatus":{"type":"string","enum":["PENDING","RUNNING","DONE","FAILED"],"title":"DoStatus"},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"IndicatorParam":{"properties":{"name":{"type":"string","title":"Name","description":"指標名","default":"SMA","examples":["SMA"]},"window":{"type":"integer","maximum":200.0,"minimum":1.0,"title":"Window","description":"計算ウィンドウ（日／バー数）","default":5,"examples":[5,20,50]}},"type":"object","title":"IndicatorParam","description":"追加計算したいテクニカル指標パラメータ。\n\n*MVP* では `name=\"SMA\"` だけを想定するが、後方互換を考慮して\n任意文字列を許容している。"},"MetricMeta":{"properties":{"name":{"type":"string","title":"Name"},"unit":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Unit"},"slo":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Slo"},"class":{"type":"string","enum":["S","A","B"],"title":"Class"}},"type":"object","required":["name","class"],"title":"MetricMeta"},"MetricValue":{"properties":{"name":{"type":"string","title":"Name"},"unit":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Unit"},"slo":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Slo"},"class":{"type":"string","enum":["S","A","B"],"title":"Class"},"ts":{"type":"integer","title":"Ts"},"value":{"type":"number","title":"Value"}},"type":"object","required":["name","class","ts","value"],"title":"MetricValue"},"PlanCreateRequest":{"properties":{"id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Id","description":"Plan ID（省略可。サーバが自動採番）","examples":["plan_abcd1234","3fa85f64-5717-4562-b3fc-2c963f66afa6"]},"symbol":{"type":"string","title":"Symbol","description":"メイン銘柄ティッカー","examples":["AAPL"]},"start":{"type":"string","format":"date","title":"Start","description":"学習開始日 (ISO-8601)"},"end":{"type":"string","format":"date","title":"End","description":"学習終了日 (ISO-8601)"}},"type":"object","required":["symbol","start","end"],"title":"PlanCreateRequest","description":"Plan 作成リクエスト。\n\n* `id` を省略した場合はルーター側で UUID を自動採番。\n* `symbol / start / end` は旧 API 互換の最小セット。"},"PlanResponse":{"properties":{"id":{"type":"string","title":"Id"},"symbol":{"type":"string","title":"Symbol"},"start":{"anyOf":[{"type":"string","format":"date"},{"type":"null"}],"title":"Start"},"end":{"anyOf":[{"type":"string","format":"date"},{"type":"null"}],"title":"End"},"created_at":{"type":"string","title":"Created At"}},"additionalProperties":true,"type":"object","required":["id","symbol","created_at"],"title":"PlanResponse","description":"Plan 取得／作成時に返す共通レスポンス。\n\n旧クライアント互換の最小キー (id / symbol / start / end / created_at)\n以外にも、DSL 全フィールドを残すため `extra=\"allow\"`。"},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"}},"securitySchemes":{"APIKeyHeader":{"type":"apiKey","in":"header","name":"x-api-key"}}}}